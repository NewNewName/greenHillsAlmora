!function(t){Galleria.requires(1.25,"The Picasa Plugin requires Galleria version 1.2.5 or later.");var e=Galleria.utils.getScriptPath();Galleria.Picasa=function(){this.options={max:30,imageSize:"medium",thumbSize:"thumb",complete:function(){}}},Galleria.Picasa.prototype={constructor:Galleria.Picasa,search:function(t,e){return this._call("search","all",{q:t},e)},user:function(t,e){return this._call("user","user/"+t,e)},useralbum:function(t,e,i){return this._call("useralbum","user/"+t+"/album/"+e,i)},setOptions:function(e){return t.extend(this.options,e),this},_call:function(e,i,n,a){i="https://picasaweb.google.com/data/feed/api/"+i+"?","function"==typeof n&&(a=n,n={});var o=this;n=t.extend({kind:"photo",access:"public","max-results":this.options.max,thumbsize:this._getSizes().join(","),alt:"json-in-script",callback:"?"},n),t.each(n,function(t,e){i+="&"+t+"="+e});var r=!1;return Galleria.utils.wait({until:function(){return r},success:function(){o._parse.call(o,r.feed.entry,a)},error:function(){var t="";"user"==e?t="user not found.":"useralbum"==e&&(t="album or user not found."),Galleria.raise("Picasa request failed"+(t?": "+t:"."))},timeout:5e3}),t.getJSON(i,function(t){r=t}),o},_getSizes:function(){var o,e=this,i={small:"72c",thumb:"104u",medium:"640u",big:"1024u",original:"1600u"},n=e.options,a={},r=[32,48,64,72,94,104,110,128,144,150,160,200,220,288,320,400,512,576,640,720,800,912,1024,1152,1280,1440,1600];return t(["thumbSize","imageSize"]).each(function(){n[this]in i?a[this]=i[n[this]]:(o=Galleria.utils.parseValue(n[this]),o>1600?o=1600:t.each(r,function(t){return this>o?(o=r[t-1],!1):void 0}),a[this]=o)}),[a.thumbSize,a.imageSize,"1280u"]},_parse:function(e,i){var o,a=[];t.each(e,function(){o=this.media$group.media$thumbnail,a.push({thumb:o[0].url,image:o[1].url,big:o[2].url,title:this.summary.$t})}),i.call(this,a)}};var i=Galleria.prototype.load;Galleria.prototype.load=function(){if(arguments.length||"string"!=typeof this._options.picasa)return void i.apply(this,Galleria.utils.array(arguments));var r,n=this,a=Galleria.utils.array(arguments),o=this._options.picasa.split(":"),s=t.extend({},n._options.picasaOptions),l="undefined"!=typeof s.loader?s.loader:t("<div>").css({width:48,height:48,opacity:.7,background:"#000 url("+e+"loader.gif) no-repeat 50% 50%"});if(o.length){if("function"!=typeof Galleria.Picasa.prototype[o[0]])return Galleria.raise(o[0]+" method not found in Picasa plugin"),i.apply(this,a);if(!o[1])return Galleria.raise("No picasa argument found"),i.apply(this,a);window.setTimeout(function(){n.$("target").append(l)},100),r=new Galleria.Picasa,"object"==typeof n._options.picasaOptions&&r.setOptions(n._options.picasaOptions);var c=[];if("useralbum"==o[0]){if(c=o[1].split("/"),2!=c.length)return void Galleria.raise("Picasa useralbum not correctly formatted (should be [user]/[album])")}else c.push(o[1]);c.push(function(t){n._data=t,l.remove(),n.trigger(Galleria.DATA),r.options.complete.call(r,t)}),r[o[0]].apply(r,c)}else i.apply(this,a)}}(jQuery);